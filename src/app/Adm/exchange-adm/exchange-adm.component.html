<div class="container">
  <div class="div-expansion-panel">
    <mat-accordion class="headers-align newExchange">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> Cadastrar </mat-panel-title>
        </mat-expansion-panel-header>
        <div [formGroup]="newExchangeControl">
          <div class="div-fields">
            <div>
              <mat-form-field appearance="outline">
                <mat-label>Nome</mat-label>
                <input matInput formControlName="name" placeholder="Ex.: Binance" />
                @if (newExchangeControl.get('name')?.hasError('required')) {
                <mat-error>Nome é <strong>obrigatório</strong></mat-error>
                }@if (newExchangeControl.get('name')?.hasError('minlength')) {
                <mat-error>Digite no mínimo <strong>3</strong> cadacteres</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Site</mat-label>
                <input matInput formControlName="exchangeUrl" placeholder="Ex.: Binance" />
                @if
                (newExchangeControl.get('exchangeUrl')?.hasError('required')) {
                <mat-error>Site é <strong>obrigatório</strong></mat-error>
                }@if
                (newExchangeControl.get('exchangeUrl')?.hasError('minlength')) {
                <mat-error>Digite no mínimo <strong>3</strong> cadacteres</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>API Url</mat-label>
                <input matInput formControlName="apiUrl" />
                @if (newExchangeControl.get('apiUrl')?.hasError('required')) {
                <mat-error>Símbolo é <strong>obrigatório</strong></mat-error>
                } @if (newExchangeControl.get('apiUrl')?.hasError('minlength'))
                {
                <mat-error>Digite no mínimo <strong>3</strong> cadacteres</mat-error>
                }
              </mat-form-field>
            </div>
            <div>
              <mat-form-field appearance="outline">
                <mat-label>Chave API</mat-label>
                <input matInput formControlName="apiKey" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Secret Key</mat-label>
                <input matInput formControlName="secretKey" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Taxa</mat-label>
                <input matInput formControlName="fee" type="number" placeholder="%" />
                @if (newExchangeControl.get('fee')?.hasError('required')) {
                <mat-error>Taxa é <strong>obrigatório</strong></mat-error>
                }
              </mat-form-field>
            </div>
          </div>
          <br />
          <button mat-flat-button [disabled]="newExchangeControl.invalid || creating" type="submit"
            [class.spinner]="creating" (click)="createExchange()">
            <mat-icon>add_circle</mat-icon> Cadastrar
          </button>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
    <mat-accordion class="headers-align editExchange">
      <mat-expansion-panel [disabled]="editExchangeControl.get('id')!.value == ''"
        [expanded]="editExchangeControl.get('id')!.value != ''">
        <mat-expansion-panel-header>
          <mat-panel-title> Editar </mat-panel-title>
          <mat-panel-description>
            {{ editExchangeControl.get("name")?.value }}
          </mat-panel-description>
        </mat-expansion-panel-header>
        <div [formGroup]="editExchangeControl">
          <div class="div-fields">
            <div>
              <mat-form-field appearance="outline">
                <mat-label>Nome</mat-label>
                <input matInput formControlName="name" placeholder="Ex.: Binance" />
                @if (editExchangeControl.get('name')?.hasError('required')) {
                <mat-error>Nome é <strong>obrigatório</strong></mat-error>
                }@if (editExchangeControl.get('name')?.hasError('minlength')) {
                <mat-error>Digite no mínimo <strong>3</strong> cadacteres</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Site</mat-label>
                <input matInput formControlName="exchangeUrl" placeholder="Ex.: Binance" />
                @if
                (editExchangeControl.get('exchangeUrl')?.hasError('required')) {
                <mat-error>Site é <strong>obrigatório</strong></mat-error>
                }@if
                (editExchangeControl.get('exchangeUrl')?.hasError('minlength'))
                {
                <mat-error>Digite no mínimo <strong>3</strong> cadacteres</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>API Url</mat-label>
                <input matInput formControlName="apiUrl" />
                @if (editExchangeControl.get('apiUrl')?.hasError('required')) {
                <mat-error>Símbolo é <strong>obrigatório</strong></mat-error>
                } @if (editExchangeControl.get('apiUrl')?.hasError('minlength'))
                {
                <mat-error>Digite no mínimo <strong>3</strong> cadacteres</mat-error>
                }
              </mat-form-field>
            </div>
            <div>
              <mat-form-field appearance="outline">
                <mat-label>Chave API</mat-label>
                <input matInput formControlName="apiKey" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Secret Key</mat-label>
                <input matInput formControlName="secretKey" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Taxa</mat-label>
                <input matInput formControlName="fee" type="number" placeholder="%" />
                @if (editExchangeControl.get('fee')?.hasError('required')) {
                <mat-error>Taxa é <strong>obrigatório</strong></mat-error>
                }
              </mat-form-field>
            </div>
          </div>
          <br />
          <div class="div-buttons-edit">
            <button mat-flat-button [disabled]="editExchangeControl.invalid || updating" type="submit"
              [class.spinner]="updating" (click)="updateExchange()">
              <mat-icon>save</mat-icon> Salvar
            </button>
            <button mat-flat-button color="accent" (click)="cancelEdit()">
              <mat-icon>cancel</mat-icon> Cancelar
            </button>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
  <br />
  <br />
  <div [hidden]="exchanges.length > 0">
    <app-loading></app-loading>
  </div>
  <div [hidden]="exchanges.length == 0">
    <mat-form-field appearance="fill" style="width: 100%">
      <mat-label>Filtrar</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="Ex. ETH" />
    </mat-form-field>
    <table mat-table class="mat-elevation-z8" [dataSource]="dsExchanges">
      <ng-container matColumnDef="logo">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let exchange">
          <img src="../../../assets/Exchanges/{{ exchange.name }}.svg" alt="" width="30px" />
        </td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Nome</th>
        <td mat-cell *matCellDef="let exchange">{{ exchange.name }}</td>
      </ng-container>

      <ng-container matColumnDef="exchangeUrl">
        <th mat-header-cell *matHeaderCellDef>Site</th>
        <td mat-cell *matCellDef="let exchange">{{ exchange.exchangeUrl }}</td>
      </ng-container>

      <ng-container matColumnDef="apiUrl">
        <th mat-header-cell *matHeaderCellDef>API Url</th>
        <td mat-cell *matCellDef="let exchange">{{ exchange.apiUrl }}</td>
      </ng-container>

      <ng-container matColumnDef="fee">
        <th mat-header-cell *matHeaderCellDef>Taxa (%)</th>
        <td mat-cell *matCellDef="let exchange">
          {{ exchange.fee / 100 | percent : "1.2-2" : "pt-br" }}
        </td>
      </ng-container>

      <ng-container matColumnDef="apiKey">
        <th mat-header-cell *matHeaderCellDef>API Key</th>
        <td mat-cell *matCellDef="let exchange">{{ exchange.apiKey }}</td>
      </ng-container>

      <ng-container matColumnDef="secretKey">
        <th mat-header-cell *matHeaderCellDef>Secret Key</th>
        <td mat-cell *matCellDef="let exchange">{{ exchange.apiSecretKey }}</td>
      </ng-container>

      <!-- Weight Column -->
      <ng-container matColumnDef="edit">
        <th mat-header-cell *matHeaderCellDef>Editar</th>
        <td mat-cell *matCellDef="let exchange">
          <button mat-icon-button color="accent" [matTooltip]="'Editar ' + exchange.name"
            (click)="loadFormEditExchange(exchange)">
            <mat-icon>edit</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Symbol Column -->
      <ng-container matColumnDef="delete">
        <th mat-header-cell *matHeaderCellDef>Excluir</th>
        <td mat-cell *matCellDef="let exchange">
          <button mat-icon-button color="warn" [matTooltip]="'Excluir ' + exchange.name"
            (click)="deleteExchange(exchange)">
            <mat-icon>delete_outline</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
</div>